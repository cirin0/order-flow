<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Деталі замовлення</title>
</head>
<body>
<h1>Деталі замовлення #<span th:text="${order.id}"></span></h1>

<div th:if="${success}" th:text="${success}" class="alert alert-success"></div>
<div th:if="${error}" th:text="${error}" class="alert alert-danger"></div>

<div class="order-details">
  <p>Статус: <span th:text="${order.statusDescription}"></span></p>
  <p>Загальна сума: <span th:text="${order.totalPrice}"></span></p>

  <!-- Додаємо секцію з адресою доставки -->
  <div class="delivery-address" th:if="${order.address != null}">
    <h3>Адреса доставки:</h3>
    <div class="address-details">
      <p>Регіон: <span th:text="${order.address.region}"></span></p>
      <p>Місто: <span th:text="${order.address.city}"></span></p>
      <p>Район: <span th:text="${order.address.area}"></span></p>
      <p>Вулиця: <span th:text="${order.address.street}"></span></p>
      <p>Будинок: <span th:text="${order.address.house}"></span></p>
      <p>Квартира: <span th:text="${order.address.apartment}"></span></p>
    </div>
  </div>

  <h3>Товари:</h3>
  <table class="order-items">
    <thead>
    <tr>
      <th>Назва</th>
      <th>Кількість</th>
      <th>Ціна</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="item : ${order.items}">
      <td th:text="${item.productName}"></td>
      <td th:text="${item.quantity}"></td>
      <td th:text="${item.price}"></td>
    </tr>
    </tbody>
  </table>

  <div th:if="${isAdmin}">
    <h3>Змінити статус:</h3>
    <form th:action="@{/orders/{id}/status(id=${order.id})}" method="post">
      <select name="status">
        <option th:each="status : ${statuses}"
                th:value="${status}"
                th:text="${status.description}"
                th:selected="${status == order.status}">
        </option>
      </select>
      <button type="submit">Оновити статус</button>
    </form>
  </div>

  <div class="order-actions">
    <form th:action="@{/payment/create}" method="post"
          th:if="${order.status.name() == 'NEW' and !isAdmin}">
      <input type="hidden" name="orderId" th:value="${order.id}"/>
      <button type="submit" class="btn-payment">Оплатити замовлення</button>
    </form>
    
    <a th:href="@{/orders/{id}/download-invoice(id=${order.id})}"
      class="btn-download"
      target="_blank">
      Завантажити pdf замовлення
    </a>
  <div>
    <form th:action="@{/orders/{id}/cancel(id=${order.id})}" method="post"
          th:if="${order.status.name() == 'NEW' || order.status.name() == 'PROCESSING'}">
      <button type="submit">Скасувати замовлення</button>
    </form>

    <form th:action="@{/orders/{id}/complete(id=${order.id})}" method="post"
          th:if="${order.status.name() == 'DELIVERED'}">
      <button type="submit">Завершити замовлення</button>
    </form>
  </div>
</div>
</body>
</html>
